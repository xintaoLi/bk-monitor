{
  "$schema": "../schemas/runtime-task.schema.json",
  "id": "debug-page-info",
  "intent": "调试：显示页面元素信息（含异常场景检测与自愈）",
  "context": {
    "component": "Debug",
    "route": "/retrieve",
    "version": "debug"
  },
  "preconditions": [],
  "steps": [
    {
      "type": "navigate",
      "url": "{{baseUrl}}/#/retrieve",
      "waitUntil": "networkidle2"
    },
    {
      "type": "wait",
      "selector": "body",
      "timeout": 10000,
      "state": "visible"
    },
    {
      "type": "wait",
      "timeout": 3000
    },
    {
      "type": "evaluate",
      "script": "() => { const hash = window.location.hash || ''; console.log('=================== 页面信息 ==================='); console.log('当前路由:', hash); console.log('是否在异常页:', hash.includes('un-authorized')); return { hash, isUnauth: hash.includes('un-authorized') }; }"
    },
    {
      "type": "click",
      "selector": "[data-testid='unauth-retry']",
      "optional": true,
      "timeout": 2000
    },
    {
      "type": "wait",
      "timeout": 2000
    },
    {
      "type": "click",
      "selector": "[data-testid='space-choice-toggle'], .menu-select-name",
      "optional": true,
      "timeout": 3000
    },
    {
      "type": "wait",
      "timeout": 2000
    },
    {
      "type": "click",
      "selector": "[data-testid='space-choice-demo']",
      "optional": true,
      "timeout": 3000
    },
    {
      "type": "wait",
      "timeout": 5000
    },
    {
      "type": "evaluate",
      "script": "() => { console.log('=================== 页面信息 ==================='); console.log('页面标题:', document.title); console.log('Body 类名:', document.body.className); console.log('当前 hash:', window.location.hash); const testIds = document.querySelectorAll('[data-testid]'); console.log('data-testid 元素:', testIds.length); testIds.forEach(el => console.log(' -', el.getAttribute('data-testid'))); return true; }"
    },
    {
      "type": "wait",
      "timeout": 2000
    }
  ],
  "signals": [
    {
      "type": "dom-visible",
      "selector": "body",
      "timeout": 15000
    }
  ],
  "metadata": {
    "priority": "low",
    "tags": ["debug", "info"],
    "estimatedDuration": 25000,
    "retryable": true
  }
}
